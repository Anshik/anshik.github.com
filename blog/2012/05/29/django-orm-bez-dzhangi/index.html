<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Ещё один блог</title>
    <meta name="description" content="">
    <meta name="author" content="Anshik">

    <link rel="stylesheet" href="/theme/css/foundation.css" />
    <link rel="stylesheet" href="/theme/css/pygment/monokai.css" />
    <link rel="stylesheet" href="/theme/css/custom.css" />

    <link rel="stylesheet" href="/theme/css/magnific-popup.css" />


    <script src="/theme/js/modernizr.js"></script>

    <!-- Feeds -->


    <!-- mathjax config similar to math.stackexchange -->
    <script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
			tex2jax: {
				inlineMath: [ ['$', '$'] ],
				displayMath: [ ['$$', '$$']],
				processEscapes: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
			},
			messageStyle: "none",
			"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
		});
		</script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="off-canvas-wrap">
    <div class="inner-wrap">
        <!-- mobile top bar to activate nav -->
        <nav class="tab-bar show-for-small">
            <section class="left-small">
                <a class="left-off-canvas-toggle menu-icon" ><span></span></a>
            </section>

            <section class="middle tab-bar-section">
                <h1 class="title">Ещё&nbsp;один&nbsp;блог</h1>
            </section>
        </nav>

        <!-- mobile side bar nav -->
        <aside class="left-off-canvas-menu">
            <ul class="off-canvas-list">
                <li><a href="">Главная</a></li>
                <li><label>Категории</label></li>
                    <li class="active"><a href="/category/raznoe.html">разное</a></li>

                <li><label>Ссылки</label></li>
                    <li><a href="/pages/training_school.html">Подготовка к школе</a></li>



                <li><label>Соц. сети</label></li>
                    <li><a href="http://vk.com/mnogosala">Я Вконтакте</a></li>
            </ul>
        </aside>

        <!-- top bar nav -->
        <nav class="top-bar hide-for-small-only" data-topbar>
            <ul class="title-area">
                <li class="name">
                    <h1><a href="/">Ещё один блог</a></h1>
                </li>
            </ul>

            <section class="top-bar-section">
                <ul class="right">
                            <li><a href="/pages/about.html">Обо мне</a></li>
                </ul>
            </section>
        </nav>

        <!-- Main Page Content and Sidebar -->
        <section class="main-section">
            <div class="row">
                <!-- Main Content -->
                <div class="medium-9 small-12 columns" role="content">
    <article>
        <h2>Django ORM без Джанги</h2>
        <div class="entry-content">
            <h3>Буду краток</h3>
<p><strong>Проблема:</strong> использовать прелести Django ORM, а он хорош, но для проекта, который не для веба. </p>
<p>Есть ответы на <a href="http://stackoverflow.com/questions/579511/using-only-the-db-part-of-django">stackoverflow</a>,
а вот <a href="http://pypi.python.org/pypi/django-standalone">это</a> я не пробовал.</p>
<!-- more -->

<h3>Опишу свой путь</h3>
<p>файл <strong>settings.py</strong></p>
<div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="n">gettext</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span>
<span class="n">PROJECT_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>


<span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="n">DEBUG</span>

<span class="n">ADMINS</span> <span class="o">=</span> <span class="p">(</span>
 <span class="c"># (&#39;Your Name&#39;, &#39;your_email@example.com&#39;),</span>
<span class="p">)</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
 <span class="p">(</span><span class="s">&#39;ru&#39;</span><span class="p">,</span> <span class="s">&#39;ru&#39;</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">DEFAULT_LANGUAGE</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
 <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span> <span class="c"># Add &#39;postgresql_psycopg2&#39;, &#39;postgresql&#39;, &#39;mysql&#39;, &#39;sqlite3&#39; or &#39;oracle&#39;.</span>
 <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_PATH</span><span class="p">,</span> <span class="s">&#39;crimson.sqlite&#39;</span><span class="p">),</span>
 <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># Not used with sqlite3.</span>
 <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># Not used with sqlite3.</span>
 <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># Set to empty string for localhost. Not used with sqlite3.</span>
 <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="c"># Set to empty string for default. Not used with sqlite3.</span>
 <span class="p">}</span>
<span class="p">}</span>

<span class="n">TEST_DATABASE_CHARSET</span> <span class="o">=</span> <span class="s">&quot;utf8&quot;</span>
<span class="n">TEST_DATABASE_COLLATION</span> <span class="o">=</span> <span class="s">&quot;utf8_general_ci&quot;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s">&#39;Europe/Moscow&#39;</span>

<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;ru-RU&#39;</span>

<span class="n">SITE_ID</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c"># If you set this to False, Django will not format dates, numbers and</span>
<span class="c"># calendars according to the current locale</span>
<span class="n">USE_L10N</span> <span class="o">=</span> <span class="bp">True</span>


<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
<span class="c"># &#39;django.contrib.auth&#39;,</span>
<span class="c"># &#39;django.contrib.contenttypes&#39;,</span>
<span class="c"># &#39;django.contrib.sessions&#39;,</span>
<span class="c"># &#39;django.contrib.sites&#39;,</span>
<span class="c"># &#39;django.contrib.messages&#39;,</span>
<span class="c"># &#39;django.contrib.staticfiles&#39;,</span>
 <span class="s">&#39;src.data_utils&#39;</span><span class="p">,</span>
 <span class="s">&#39;src.crimsonmap&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>


<p>Создаём у себя в корне проекта такой файл.</p>
<p>Затем, там же в папке проекта <strong>manage.py</strong></p>
<div class="highlight"><pre><span class="c">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">django.core.management</span> <span class="kn">import</span> <span class="n">execute_manager</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="k">try</span><span class="p">:</span>
 <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;settings&#39;</span><span class="p">)</span> <span class="c"># Assumed to be in the same directory.</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
 <span class="kn">import</span> <span class="nn">sys</span>
 <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;Error: Can&#39;t find the file &#39;settings.py&#39; in the directory containing </span><span class="si">%r</span><span class="s">. It appears you&#39;ve customized things.</span><span class="se">\n</span><span class="s">You&#39;ll have to run django-admin.py, passing it your settings module.</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">__file__</span><span class="p">)</span>
 <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">settings</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
 <span class="n">execute_manager</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</pre></div>


<p>Ещё создаём пустой файл <strong><strong>init</strong>.py</strong></p>
<p>И файл <strong>urls.py</strong></p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls.defaults</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>

<span class="c"># Uncomment the next two lines to enable the admin:</span>
<span class="c"># from django.contrib import admin</span>
<span class="c"># admin.autodiscover()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
 <span class="c"># Examples:</span>
 <span class="c"># url(r&#39;^$&#39;, &#39;src.views.home&#39;, name=&#39;home&#39;),</span>
 <span class="c"># url(r&#39;^src/&#39;, include(&#39;src.foo.urls&#39;)),</span>

 <span class="c"># Uncomment the admin/doc line below to enable admin documentation:</span>
 <span class="c"># url(r&#39;^admin/doc/&#39;, include(&#39;django.contrib.admindocs.urls&#39;)),</span>

 <span class="c"># Uncomment the next line to enable the admin:</span>
 <span class="c"># url(r&#39;^admin/&#39;, include(admin.site.urls)),</span>
<span class="p">)</span>
</pre></div>


<p>Теперь создаём папку с аппом, в котором будет лежать модель
у меня это src -&lt;--- корень проекта, crimsonmap, это поддиректория
src/crimsonmap
В этой поддиректории создаём пустой файл:
<strong>init</strong>.py - это для того чтобы джанга поняла, что тут лежит апп
models.py</p>
<div class="highlight"><pre><span class="c"># coding: utf-8</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Terrarian</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
   <span class="n">ter_type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;terrarian type&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
   <span class="n">ter_color</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;terrarian color html&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>
   <span class="n">ter_hunting</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;ter hunting percent&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">ter_meeting</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;ter meeting percent&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
   <span class="n">player_maybehere</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;player may be here&#39;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Дальше как обычно из /src:</p>
<div class="highlight"><pre>python manage.py syncdb
</pre></div>


<p>создастся база данных и радость</p>
<p>И затем, когда нужно использовать нашу базу:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;settings&quot;</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">Terrarian</span>
</pre></div>


<p>Есть ещё пацанский метод заполнения базы данных, если кому нужно пишите в комментах, опишу, так лень.</p>
        </div><!-- /.entry-content -->
        <hr/>

    </article>

    <h6><a href="/pages/about.html">Anshik</a> в <a href="/category/raznoe.html">разное</a>  Вт. 29 Май 2012. Tags: <a href="/tag/django.html">[Django</a>, <a href="/tag/django-orm.html">Django ORM</a>, <a href="/tag/django-orm-bez-django.html">Django ORM без Django]</a>, </h6>

    <hr/>
                </div>
                <!-- End Main Content -->
                <!-- Sidebar -->
                <aside class="medium-3 hide-for-small-only columns">



                    <div class="panel">
                        <h5>Социальные сети</h5>
                        <ul class="side-nav">
                                <li><a href="http://vk.com/mnogosala">Я Вконтакте</a></li>
                        </ul>
                    </div>
                </aside>
                <!-- End Sidebar -->
            </div>

            <!-- Footer -->
            <footer class="row">
                <div class="medium-9 small-12">
                    <hr/>
                    <p class="text-center">&copy; Anshik 2012-2015</p>
                </div>
            </footer>
            <!-- End Footer -->
        </section>
        <a class="exit-off-canvas"></a>
    </div><!--off-canvas inner-->
</div><!--off-canvas wrap-->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="/theme/js/foundation.min.js"></script>
<script>
    $(document).foundation();
</script>

<script src="/theme/js/jquery.magnific-popup.min.js"></script>
<script>
    $('.gallery').magnificPopup({
        delegate: 'a',
        type: 'image',
        gallery: {
            enabled: true,
            navigateByImgClick: true,
            preload: [1,2]
        },
        image: {
            titleSrc: function(item) {
                if (item.el.attr('caption') && item.el.attr('exif')) {
                    return (item.el.attr('caption').replace(/\\n/g, '<br />') +
                    '<small>' + item.el.attr('title') + ' - ' + item.el.attr('exif') + '</small>');
                }
                return item.el.attr('title') + '<small>' + item.el.attr('exif') + '</small>';
            } }
    });
</script>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter30550117 = new Ya.Metrika({id:30550117,
                    webvisor:true,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true});
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
                s = d.createElement("script"),
                f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/30550117" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</body>
</html>